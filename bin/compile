#!/usr/bin/env bash
# bin/compile BUILD_DIR CACHE_DIR ENV_DIR
set -euo pipefail

BUILD_DIR="$1"
CACHE_DIR="$2"
ENV_DIR="$3"
OPENRESTY_DIR="$BUILD_DIR/openresty"

mkdir -p "$OPENRESTY_DIR"
tar -zxf "openresty-$STACK".tar.gz -C "$OPENRESTY_DIR"

echo "-----> openresty: Installed $(cat $OPENRESTY_DIR/version.txt)"

if [[ -f "$BUILD_DIR/opm.txt" ]]; then
    xargs "$OPENRESTY_DIR/bin/opm" get < "$BUILD_DIR/opm.txt"
fi
